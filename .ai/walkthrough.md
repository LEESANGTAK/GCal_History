# 구글 캘린더 실제 일정 자동완성 연동 완료

이전에 직접 입력한 텍스트를 로컬에 저장하여 기반으로 하던 방식에서, **실제 구글 캘린더에 등록된 일정을 API를 통해 가져와 자동완성에 사용하는 방식**으로 성공적으로 마이그레이션 및 구현했습니다.

## 주요 변경 사항
1. **`manifest.json` 업데이트:** 클라이언트 ID (`952545109836-81hr85t7cl6m5atuu6f8eb5eo6409ph4.apps.googleusercontent.com`)가 정상적으로 등록되었으며, `identity` 권한이 추가되었습니다.
2. **`background.js` 추가:** OAuth 인증 창을 띄워 토큰을 받아오고, Google Calendar API (`/v3/calendars/primary/events`)를 호출하여 최근 1년 치의 실제 일정들을 가져옵니다. (매번 API를 호출하지 않도록 로컬에 캐싱합니다.)
3. **`content.js` 개선:**
   - 더 이상 키보드 타이핑 내용을 자체적으로 가로채어 저장하지 않습니다.
   - 백그라운드 스크립트에서 받아온 "실제 일정" 데이터셋을 기준으로 필터링하여 드롭다운 UI에 보여줍니다.
   - 개별 삭제 기능(휴지통/X버튼)은 읽기 전용 API 데이터 특성상 비활성화 및 안내 처리를 추가했습니다.

## 수동 테스트 가이드

이 작업은 구글 캘린더 사이트에서 직접 확인해주셔야 합니다.

1. 열려있는 크롬의 `chrome://extensions/` 페이지로 이동합니다.
2. 개발자 모드가 켜진 상태에서, **G-Cal History** 확장 프로그램의 새로고침 버튼(🔄)을 클릭합니다.
   - *팁: 오류가 보인다면 `백그라운드 페이지` 또는 `서비스 워커`를 클릭해서 로그에 에러가 없는지 확인할 수 있습니다.*
3. [구글 캘린더(https://calendar.google.com/)](https://calendar.google.com/)를 엽니다. (이미 열려 있다면 새로고침 하세요.)
4. 구글 캘린더 내 빈 곳을 클릭하여 "새 일정 추가 모달창"을 띄웁니다.
5. 이때 우측 상단이나 새 탭 등에 **구글 계정 로그인/권한 승인 창**이 뜰 수 있습니다. 권한을 승인해 줍니다.
6. 권한이 승인된 후(또는 이미 승인되었다면), **일정 제목 입력칸**에 자신의 캘린더에 이미 존재하는 이벤트 제목의 앞글자를 입력해 보세요.
7. 아래쪽으로 실제 일정 기반의 자동완성 드롭다운이 뜨고, 클릭하면 해당 제목이 정상적으로 덮어씌워지는지 확인합니다.

> [!NOTE]
> 만약 팝업이나 권한 요청이 제대로 뜨지 않거나 확장 프로그램에서 오류가 난다면, [Google Cloud Console의 해당 클라이언트 설정](https://console.cloud.google.com/)에서 '테스트 사용자' 항목에 현재 로그인한 구글 계정이 잘 등록되어 있는지 한 번 더 확인해 주세요!

## 추가 개선 완료 사항 (고도화)
- **다중 캘린더 지원:** 주 캘린더만이 아니라 사용자가 소유한 `모든` 캘린더(기념일, Private 등)에서 일정을 가져오도록 병렬 API 호출 기능을 구현했습니다.
- **캘린더 자동 선택(Auto-select):** 기존 일정의 타이틀을 선택하면, 일정을 추가하는 팝업 안에서 해당 이벤트가 원래 속해있던 캘린더 드롭다운을 스크립트가 찾아 (React 합성 이벤트를 모방하여) 자동으로 맞춰주는 기능을 개발했습니다. (사이드바 메뉴가 오클릭되는 현상을 팝업 스코프 제한으로 해결)
- **UI 즉각 업데이트:** 단순히 입력창의 DOM value만 수정할 경우 캘린더 프론트엔드가 변경사항을 즉시 감지하지 못하던 문제를 완전하게 해소했습니다. `focus()` -> `value setter` -> `input/change 이벤트` -> `keydown/keyup 이벤트` -> `blur()` 를 순차적으로 강제 발생시켜 정상적으로 값이 확정되도록 처리했습니다.
